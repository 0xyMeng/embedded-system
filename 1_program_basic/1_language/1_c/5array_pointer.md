---
sort: 5
---
# 数组和指针

- 关键字 `static`
- 运算符 `&` `*` (一元)
- 创建和初始化数组
- 指针、指针和数组
- 处理数组的函数
- 二维数组


## 数组

C99 标准中的新特性：指定初始化器(designated initializer)，可以初始化指定的元素。

```c
int array[50] = {
    0,
    1,
    [20] = 20,
    21,
    [49] = 49,
};
```

```c
int arr[5] = {1, 2, 3, 4, 5};
```

未初始化的都为 0.

C 语言的数组要注意边界，数组越界也是一个数组使用的常见问题。

二维数组。


## 指针和数组

```c
int a = 10, b = 20;
p = &a;  // p指向a
p = &b;  // p现在指向b
```

指针提供了一种用符号使用地址的方法。计算机硬件指令依赖地址，指针把程序员的想法以更接近机器的方式传递给机器

- 指针的值是它指向的地址。许多计算机按字节编址，一个 int 类型的地址通常是第一个字节的地址
- 指针前面使用 `*` 可以得到指向对象的值
- 指针加 1，指针的值递增指向类型的大小

```c
dates + 2 == &dates[2]  //相同地址
*(dates + 2) == dates[2] //相同的值
```
上例说明数组和指针关系密切。


- 指针和数组的区别
  - 指针存放地址变量，可以修改
  - 数组是存储多个元素的集合。数组名本身可以用作指向数组首元素的指针，但数组本质上是一个固定大小的内存块。


## 函数、数组和指针

C 语言函数处理数组是本质上传入的是指针，所以通常要有一个额外的参数指明数组长度

```c
int sum(int *arr, int n)
{
  int total = 0;
  for (int i=0; i<n; i++)
    total += arr[i];
  return total;
}
```

注意第一个参数是指针形参。还有另一种操作方法

```c
int sum(int * start, int *end)
{
    int total = 0;
    while(start < end)
        total += *(start++);
        return total; 
}
```

指针变量的基本操作
- 复制
- 解引用 ，即 `*ptr` 计算出指向地址的值
- 取地址，指针存放的地址
- 指针与整数相加，如 `ptr + 2` ，先用整数和指向类型大小相乘，然后与初始地址相加
- 指针递增，移动到下一元素，本质和加整数一样
- 指针求差 `ptr1 - ptr2` ，计算同一数组两元素的距离

## 数组中数据的保护

通常处理数组时，传递地址的问题：会对数据产生修改。有时候我们并不会修改数组数据，只读。更好的做法：

```c
int sum(const int * arr, int n)
{
    int total = 0;

    for (int i=0; i<n; i++)
      total += arr[i];

    return total; 
}
```

`const` 告诉编译器，函数不可以修改此指针指向的内容。

关于 const，如果定义一个常量

```c
#define PI 3.14159

const double pi = 3.14159;
```

还有一个要注意的

```c
const int nums[5] = {1, 2, 3, 4, 5};

int * ptr = nums;   //不合法
```


