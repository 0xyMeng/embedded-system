---
sort: 1
---
# 简单入门


## 系统启动

芯片上电后，先运行汇编代码 `startup_stm32f103xe.s` ，然后跳转到 C 代码，进行 RT-Thread 系统功能初始化，最后才执行 `main()` 。

在这里使用 ARM CC 编译器时的一个特性。 `$Sub$$` 和 `$Super$$` 语法， `$Sub$$` 的含义是在程序只想前插入一段新程序， `$Super$$` 含义为在程序前插入一点已有代码。有点打补丁的意思。

主函数在文件 `components.c` 里“打了个补丁”，其作用是在用户程序前启动 RT-Thread 的相关功能

```c
int $Sub$$main(void)
{
    rt_hw_interrupt_disable();
    rtthread_startup();
    return 0;
}
```

这部分代码和编译器相关， ARM CC 里是这么处理的，其他编译器不支持 `$Sub$$` 语法，也有从汇编启动代码部分直接跳到 `rtthread_startup();` 的，总之这个是必要的，它也定义在这个源文件里：

```c
int rtthread_startup(void)
{
    rt_hw_interrupt_disable();
    rt_hw_board_init();
    rt_show_version();
    rt_system_timer_init();
    rt_system_scheduler_init();
    rt_system_signal_init();
    rt_application_init();
    rt_system_timer_thread_init();
    rt_thread_idle_init();
    rt_system_scheduler_start();

    return 0; /* never reach here */
}
```

这个函数启动了与系统相关的硬件、内核对象、系统设备，最终初始化了各应用线程，启动调度器。



## 用户入口

前面是必要的内核启动，对于用户程序，还是经典的 `main()` 函数，这里也能看出前面定义 `$Sub$$main()` 的含义，这是函数标识符，具体可以参考[ARM® Compiler v5.06 for µVision® armlink User Guide](http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0377g/pge1362065967698.html)。


```c
int main(void)
{
  /* user app entry */
  return 0;
}
```

这么设计符合以前不用RTOS的开发者的习惯，只是用就可以了，不需要关注应用之外的东西。


## RTOS 点灯

这是一个线程，

```c
int led(void)
{
    rt_uint8_t count;

    rt_pin_mode(34, PIN_MODE_OUTPUT);  
    
    for(count = 0 ; count < 10 ;count++)
    {       
        rt_pin_write(LED_PIN, PIN_HIGH);
        rt_kprintf("led计数 : %d\r\n", count);
        rt_thread_mdelay(500);
        
        rt_pin_write(LED_PIN, PIN_LOW);
        rt_kprintf("led off\r\n");
        rt_thread_mdelay(500);
    }
    return 0;
}
MSH_CMD_EXPORT(led1, LED test);
```







