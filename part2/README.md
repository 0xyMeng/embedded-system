---
sort: 2
---
# 基于RTOS进行MCU系统开发


RTOS运行的线程或者叫任务。

操作系统的基本思路是CPU分时执行不同的线程，比如对于两个线程A和B。


```c
void thread_A()
{
    while(1)
    {

    }
}

void thread_B()
{
    while(1)
    {

    }
}
```

首先遇到的问题是，线程A执行到一半打断去执行线程B，和中断类似，在切换的时候也要对正在执行的这个情况一个现场保存。

全局变量并不需要保存，函数内的局部变作用域只在函数内，保存在栈上，如果每个线程都有自己的栈，那么也不需要保存。需要保存的是运算的**中间结果**。

C语言程序并不是最终跑在CPU上的东西，比如说语句`a=a+1;`需要拆成几步去完成，这就设计到ARM架构和汇编了。

函数本身保存子Flash上，全局变量在内存上给所有任务用，任务的局部变量保存在自己的任务栈上，运行的中间结果是保存在**寄存器**里的。因此在任务切换时，需要去保存寄存器的值。



