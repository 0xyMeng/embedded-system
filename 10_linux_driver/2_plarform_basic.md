---
sort: 2
---
# 平台设备驱动

## 驱动的分离与分层

三种 SOC 上面都外挂了 MPU6050 传感器，按照裸机的思路的驱动。每个 SOC 下都需要做 I2C 控制器的初始化即相关配置，即 I2C 主机驱动。此外，还要对 MPU6050 内部的寄存器进行配置，这是设备驱动。

不管对于哪个 SOC ，对于 MPU6050 的配置都是一样的，用法也是一样的，所以考虑每个 SOC 的 I2C 控制器都搞一个统一的接口(主机驱动)，每个设备都用统一的接口驱动来操作。

考虑更多的 I2C 设备比如 AT24C02、OELD 等，那么就有主机驱动、核心层、设备驱动这三层。

也即 总线、驱动、设备模型。

## platform 简介

SOC 中有些外设是没有总线这个概念的。大量设备直接属于片上系统，比如 UART 控制器、SPI 控制器。平台总线用来处理这些设备。

这些设备可以称为平台设备，平台总线像其他总线一样工作，但是设备是静态枚举的，区别动态发现。

总线驱动程序对设备和设备驱动程序进行匹配时，调用 `probe` 函数，初始化设备，并注册到合适的内核框架。



